import{u as G,r as c,j as e}from"./index-Dz2LKTib.js";import{a as B,C as o,D as O}from"./Card-CBGbtaDN.js";import{C as y,T as J}from"./Table-VFwCZ_-6.js";import{B as u}from"./Button-C4WQrzF6.js";import{M as K}from"./Modal-DNdioqGQ.js";import{u as Q,a as Y}from"./useFirestore-CGlNlAFc.js";import{F as Z}from"./firestoreService-CvbnsnDf.js";import{A as ee,S as se}from"./search-CZ8t1Xp6.js";import{c as te}from"./createLucideIcon-CZPXBe3C.js";import{X as v}from"./x-circle-D-NmHiuO.js";import{F as ae,C as re}from"./filter-DiZGUoel.js";import{U as ne}from"./user-InAlZBAA.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=te("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),Ne=()=>{var q,$;const{user:S}=G(),{withdrawalRequests:d,loading:w,error:k,refetch:A}=Q(),{investors:W}=Y(),[m,F]=c.useState("all"),[b,T]=c.useState(""),[x,R]=c.useState({}),[E,h]=c.useState(!1),[r,g]=c.useState(null),[l,U]=c.useState("approve"),[C,p]=c.useState(""),[le,j]=c.useState(""),i=d.filter(s=>{const t=m==="all"||m==="pending"&&s.status==="Pending"||m==="approved"&&s.status==="Approved"||m==="rejected"&&s.status==="Rejected",a=s.investorName.toLowerCase().includes(b.toLowerCase())||s.amount.toString().includes(b);return t&&a}),f=s=>W.find(t=>t.id===s),D=s=>{const t=s.toLowerCase();return t.includes("omar ehab")?"Custody Wallet":t.includes("rodrigo alfonso")?"Crypto":t.includes("pablo canales")?"Bitso, S.A.P.I. de C.V.":t.includes("haas raphael")||t.includes("herreman")?"Mercado Pago CNBV":t.includes("javier francisco")?"Banorte (GFNorte)":t.includes("pamela medina")||t.includes("patricia")&&t.includes("perea")?"Third Party":"Bitso, S.A.P.I. de C.V."},V=async(s,t,a)=>{if(S){R(n=>({...n,[s]:!0}));try{const n=t==="approve"?"Approved":"Rejected";await Z.updateWithdrawalRequest(s,n,S.id,a),await A(),h(!1),g(null),p(""),j("")}catch(n){console.error(`Error ${t}ing withdrawal:`,n)}finally{R(n=>({...n,[s]:!1}))}}},z=(s,t)=>{g(s),U(t),h(!0);const a=f(s.investorId);a&&j(`Account Holder: ${a.name}
Country: ${a.country}`)},H=()=>{r&&V(r.id,l,C)},L=d.filter(s=>s.status==="Pending").length,P=d.filter(s=>s.status==="Approved").length,I=d.filter(s=>s.status==="Rejected").length,X=d.filter(s=>s.status==="Pending").reduce((s,t)=>s+t.amount,0),_=[{key:"investorName",header:"Investor Details",render:(s,t)=>{const a=f(t.investorId);return e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:s}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",t.investorId.slice(-8)]}),a&&e.jsx("p",{className:"text-xs text-gray-500",children:a.country})]})}},{key:"amount",header:"Amount Requested",align:"right",render:s=>e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-lg text-gray-800",children:["$",(s==null?void 0:s.toLocaleString())||"0"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"USD"})]})},{key:"date",header:"Request Date",render:s=>{const t=new Date(s);return e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"font-medium",children:t.toLocaleDateString()})})}},{key:"bankDetails",header:"Bank Details",render:(s,t)=>{const a=D(t.investorName);return e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-medium",children:a})})}},{key:"status",header:"Status",render:(s,t)=>{let a="bg-gray-100",n="text-gray-800",N=null;return s==="Approved"?(a="bg-green-100",n="text-green-800",N=e.jsx(y,{size:14,className:"mr-1"})):s==="Rejected"?(a="bg-red-100",n="text-red-800",N=e.jsx(v,{size:14,className:"mr-1"})):s==="Pending"&&(a="bg-amber-100",n="text-amber-800",N=e.jsx(M,{size:14,className:"mr-1"})),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("span",{className:`px-3 py-1 text-sm rounded-full flex items-center w-fit ${a} ${n}`,children:[N,s]}),t.processedAt&&e.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.processedAt).toLocaleDateString()})]})}},{key:"actions",header:"Actions",align:"center",render:(s,t)=>t.status!=="Pending"?e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"Processed"}),t.reason&&e.jsx("p",{className:"text-xs text-gray-400 max-w-32 truncate",children:t.reason})]}):e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs(u,{variant:"success",size:"sm",onClick:()=>z(t,"approve"),isLoading:x[t.id],disabled:x[t.id],className:"w-full",children:[e.jsx(y,{size:14,className:"mr-1"}),"Approve"]}),e.jsxs(u,{variant:"danger",size:"sm",onClick:()=>z(t,"reject"),isLoading:x[t.id],disabled:x[t.id],className:"w-full",children:[e.jsx(v,{size:14,className:"mr-1"}),"Reject"]})]})}];return k?e.jsx(B,{title:"Withdrawal Management",children:e.jsx(o,{title:"Error",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{size:48,className:"mx-auto text-red-500 mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:k}),e.jsx(u,{variant:"outline",onClick:A,children:"Retry"})]})})}):e.jsxs(B,{title:"Withdrawal Management",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Withdrawal Requests"}),e.jsx("p",{className:"text-gray-600",children:"Review and process investor withdrawal requests with detailed bank information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs(o,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-amber-100 rounded-lg mx-auto mb-3",children:e.jsx(M,{className:"text-amber-600",size:24})}),e.jsx("h3",{className:"text-gray-500 font-medium mb-2",children:"Pending Requests"}),e.jsx("p",{className:"text-3xl font-bold text-amber-600",children:L})]}),e.jsxs(o,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-lg mx-auto mb-3",children:e.jsx(O,{className:"text-red-600",size:24})}),e.jsx("h3",{className:"text-gray-500 font-medium mb-2",children:"Pending Amount"}),e.jsxs("p",{className:"text-3xl font-bold text-red-600",children:["$",X.toLocaleString()]})]}),e.jsxs(o,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-green-100 rounded-lg mx-auto mb-3",children:e.jsx(y,{className:"text-green-600",size:24})}),e.jsx("h3",{className:"text-gray-500 font-medium mb-2",children:"Approved"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:P})]}),e.jsxs(o,{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gray-100 rounded-lg mx-auto mb-3",children:e.jsx(v,{className:"text-gray-600",size:24})}),e.jsx("h3",{className:"text-gray-500 font-medium mb-2",children:"Rejected"}),e.jsx("p",{className:"text-3xl font-bold text-gray-600",children:I})]})]}),e.jsx(o,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{size:18,className:"text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filter by status:"})]}),e.jsx("div",{className:"flex space-x-2",children:[{key:"all",label:"All",count:d.length},{key:"pending",label:"Pending",count:L},{key:"approved",label:"Approved",count:P},{key:"rejected",label:"Rejected",count:I}].map(s=>e.jsxs("button",{onClick:()=>F(s.key),className:`px-3 py-1 rounded-full text-sm font-medium transition-colors ${m===s.key?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[s.label," (",s.count,")"]},s.key))})]}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{size:18,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by investor name or amount...",value:b,onChange:s=>T(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-64"})]})]})}),e.jsxs(o,{title:`Withdrawal Requests (${i.length})`,children:[e.jsx(J,{columns:_,data:i,isLoading:w,emptyMessage:"No withdrawal requests found"}),!w&&i.length>0&&e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Showing Results"}),e.jsxs("p",{className:"font-semibold",children:[i.length," of ",d.length," requests"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Total Amount (Filtered)"}),e.jsxs("p",{className:"font-semibold text-blue-600",children:["$",i.reduce((s,t)=>s+t.amount,0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Average Request"}),e.jsxs("p",{className:"font-semibold text-indigo-600",children:["$",i.length>0?Math.round(i.reduce((s,t)=>s+t.amount,0)/i.length).toLocaleString():"0"]})]})]})})]}),e.jsx(K,{isOpen:E,onClose:()=>{h(!1),g(null),p(""),j("")},title:`${l==="approve"?"Approve":"Reject"} Withdrawal Request`,size:"lg",children:r&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(re,{size:18,className:"mr-2"}),"Request Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Investor"}),e.jsx("p",{className:"font-medium",children:r.investorName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Amount"}),e.jsxs("p",{className:"font-bold text-lg",children:["$",r.amount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Request Date"}),e.jsx("p",{className:"font-medium",children:new Date(r.date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Current Status"}),e.jsx("p",{className:"font-medium",children:r.status})]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-gray-800 mb-3 flex items-center",children:[e.jsx(ne,{size:18,className:"mr-2"}),"Bank & Contact Information"]}),e.jsx("div",{className:"text-sm space-y-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Account Holder"}),e.jsx("p",{className:"font-medium",children:r.investorName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Country"}),e.jsx("p",{className:"font-medium",children:((q=f(r.investorId))==null?void 0:q.country)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Bank/Platform"}),e.jsx("p",{className:"font-medium",children:D(r.investorName)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Account Status"}),e.jsx("p",{className:"font-medium",children:(($=f(r.investorId))==null?void 0:$.accountStatus)||"Active"})]})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[l==="approve"?"Approval Notes":"Rejection Reason",l==="reject"&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:C,onChange:s=>p(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:l==="approve"?"Add any notes about this approval (optional)...":"Please provide a clear reason for rejection...",required:l==="reject"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(u,{variant:"outline",onClick:()=>{h(!1),g(null),p(""),j("")},children:"Cancel"}),e.jsx(u,{variant:l==="approve"?"success":"danger",onClick:H,isLoading:x[r.id],disabled:l==="reject"&&!C.trim(),children:l==="approve"?e.jsxs(e.Fragment,{children:[e.jsx(y,{size:18,className:"mr-2"}),"Approve Withdrawal"]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:18,className:"mr-2"}),"Reject Withdrawal"]})})]})]})})]})};export{Ne as default};
